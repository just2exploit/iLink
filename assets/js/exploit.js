
var char_exploit;
var dr_device;

function light_on(){
  var buffer1 =[0x55,0xaa,0x01,0x08,0x05,0x01,0xf1] ;
  writedata=Uint8Array.from(buffer1);
  char_exploit.writeValue(writedata);
}

function light_off(){
  var buffer1 =[0x55,0xaa,0x01,0x08,0x05,0x00,0xf2] ;
  writedata=Uint8Array.from(buffer1);
  char_exploit.writeValue(writedata);
}

function color_red(){
  var buffer1 =[0x55,0xaa,0x03,0x08,0x02,0xff,0x00,0x00,0xf4] ;
  writedata=Uint8Array.from(buffer1);
  char_exploit.writeValue(writedata);
}

function color_green(){
  var buffer1 =[0x55,0xaa,0x03,0x08,0x02,0x00,0xff,0x00,0xf4] ;
  writedata=Uint8Array.from(buffer1);
  char_exploit.writeValue(writedata);
}

function color_blue(){
  var buffer1 =[0x55,0xaa,0x03,0x08,0x02,0x00,0x00,0xff,0xf4] ;
  writedata=Uint8Array.from(buffer1);
  char_exploit.writeValue(writedata);
}

function color_white(){
  var buffer1 =[0x55,0xaa,0x01,0x08,0x09,0x01,0xED] ;
  writedata=Uint8Array.from(buffer1);
  char_exploit.writeValue(writedata);
}

function color_alarm(){
  var buffer1 =[0x55,0xaa,0x01,0x08,0x06,0x07,0xEA] ;
  writedata=Uint8Array.from(buffer1);
  char_exploit.writeValue(writedata);
}

function color_rainbow(){
  var buffer1 =[0x55,0xaa,0x01,0x08,0x06,0x01,0xf0] ;
  writedata=Uint8Array.from(buffer1);
  char_exploit.writeValue(writedata);
}

function device_connect() {
    let serviceUuid = "0000a032-0000-1000-8000-00805f9b34fb";
    let characteristicUuid = "0000a040-0000-1000-8000-00805f9b34fb"

    navigator.bluetooth.requestDevice
        ({
            filters: [{ services: [serviceUuid] }]
            , optionalServices: [serviceUuid]
        })
        .then(device => {
          dr_device=device;
          return device.gatt.connect();
         })
        .then(server => { return server.getPrimaryService(serviceUuid); })
        .then(service => { return service.getCharacteristic(characteristicUuid); })
        .then(characteristic => { char_exploit=characteristic; })
        .catch(error => {
            console.log('Error! ' + error);
        });
}

function device_disconnect(){
  if (dr_device.gatt.connected)
  {
    dr_device.gatt.disconnect();
  }
}
